"use strict";(self.webpackChunkcybersec_writeups=self.webpackChunkcybersec_writeups||[]).push([[4934],{4021:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"concept/persistence","title":"Persistence Explained","description":"Understand what persistence is, why it\'s used, and how adversaries achieve it in post-exploitation.","source":"@site/docs/concept/persistence.md","sourceDirName":"concept","slug":"/concept/persistence","permalink":"/docs/concept/persistence","draft":false,"unlisted":false,"editUrl":"https://github.com/ObsidianStrike/cybersec-writeups/tree/main/docs/concept/persistence.md","tags":[{"inline":true,"label":"post-exploitation","permalink":"/docs/tags/post-exploitation"},{"inline":true,"label":"red-team","permalink":"/docs/tags/red-team"},{"inline":true,"label":"persistence","permalink":"/docs/tags/persistence"},{"inline":true,"label":"windows","permalink":"/docs/tags/windows"},{"inline":true,"label":"linux","permalink":"/docs/tags/linux"},{"inline":true,"label":"diataxis:explanation","permalink":"/docs/tags/diataxis-explanation"}],"version":"current","sidebarPosition":12,"frontMatter":{"id":"persistence","title":"Persistence Explained","description":"Understand what persistence is, why it\'s used, and how adversaries achieve it in post-exploitation.","slug":"/concept/persistence","sidebar_label":"Persistence","sidebar_position":12,"tags":["post-exploitation","red-team","persistence","windows","linux","diataxis:explanation"]},"sidebar":"tutorialSidebar","previous":{"title":"Post-Exploitation Recon","permalink":"/docs/concept/post-recon"},"next":{"title":"Creds","permalink":"/docs/concept/credential-access"}}');var r=n(4848),t=n(8453);const c={id:"persistence",title:"Persistence Explained",description:"Understand what persistence is, why it's used, and how adversaries achieve it in post-exploitation.",slug:"/concept/persistence",sidebar_label:"Persistence",sidebar_position:12,tags:["post-exploitation","red-team","persistence","windows","linux","diataxis:explanation"]},d="Persistence",o={},l=[{value:"\ud83d\udca1 Why Persistence Matters",id:"-why-persistence-matters",level:2},{value:"\ud83d\udd0d What Is Considered Persistence?",id:"-what-is-considered-persistence",level:2},{value:"\ud83e\ude9f On Windows:",id:"-on-windows",level:3},{value:"\ud83d\udc27 On Linux/macOS:",id:"-on-linuxmacos",level:3},{value:"\ud83e\udde0 Strategic Considerations",id:"-strategic-considerations",level:2},{value:"\ud83d\udd12 OPSEC Concerns",id:"-opsec-concerns",level:2},{value:"\ud83e\udded Where Does Persistence Fit?",id:"-where-does-persistence-fit",level:2},{value:"\ud83d\udccc Summary",id:"-summary",level:2}];function a(e){const s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"persistence",children:"Persistence"})}),"\n",(0,r.jsxs)(s.p,{children:["Persistence is the technique by which an adversary ensures ",(0,r.jsx)(s.strong,{children:"continued access"})," to a compromised system\u2014even after reboots, logouts, or temporary disconnections. It is one of the defining characteristics of a ",(0,r.jsx)(s.strong,{children:"determined attacker"})," and a critical phase in real-world intrusions, Advanced Persistent Threats (APTs), and red team operations."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-why-persistence-matters",children:"\ud83d\udca1 Why Persistence Matters"}),"\n",(0,r.jsx)(s.p,{children:"Once access has been gained, it can easily be lost. A user rebooting their machine, an AV cleanup script, or even a missed heartbeat from your C2 implant can sever your connection."}),"\n",(0,r.jsxs)(s.p,{children:["Persistence is about ensuring ",(0,r.jsx)(s.strong,{children:"reliable access over time"}),"\u2014it\u2019s the difference between a one-off shell and full control over the environment."]}),"\n",(0,r.jsx)(s.p,{children:"It enables:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Resilience"}),": Maintain presence across disruptions."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Strategic Operations"}),": Execute long-term actions at a time of your choosing."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Multi-stage Campaigns"}),": Lay groundwork for lateral movement and privilege escalation."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Stealth"}),": Blend in with scheduled tasks, services, registry keys, or startup folders."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-what-is-considered-persistence",children:"\ud83d\udd0d What Is Considered Persistence?"}),"\n",(0,r.jsx)(s.p,{children:"Persistence can take many forms depending on OS, privileges, and tooling:"}),"\n",(0,r.jsx)(s.h3,{id:"-on-windows",children:"\ud83e\ude9f On Windows:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Category"}),(0,r.jsx)(s.th,{children:"Examples"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Startup Items"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Scheduled Tasks"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"schtasks /create"}),", ",(0,r.jsx)(s.code,{children:"Task Scheduler GUI"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Registry Keys"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Services"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"New-Service"}),", ",(0,r.jsx)(s.code,{children:"sc.exe"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"WMI Subscriptions"})}),(0,r.jsx)(s.td,{children:"Event-triggered payloads"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Office Macros"})}),(0,r.jsx)(s.td,{children:"Documents that run scripts"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"DLL Hijacking"})}),(0,r.jsx)(s.td,{children:"Abuse of load order or PATH"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Signed Binaries"})}),(0,r.jsxs)(s.td,{children:["LOLBAS (e.g., ",(0,r.jsx)(s.code,{children:"mshta"}),", ",(0,r.jsx)(s.code,{children:"regsvr32"}),")"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Credential Dumping"})}),(0,r.jsx)(s.td,{children:"Steal tokens and automate re-login"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"-on-linuxmacos",children:"\ud83d\udc27 On Linux/macOS:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Category"}),(0,r.jsx)(s.th,{children:"Examples"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Crontabs"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@reboot /path/to/script.sh"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Init Scripts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"/etc/init.d"}),", ",(0,r.jsx)(s.code,{children:"/etc/rc.local"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Systemd Services"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"~/.config/systemd/user/"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Bash Profile"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:".bashrc"}),", ",(0,r.jsx)(s.code,{children:".bash_profile"}),", ",(0,r.jsx)(s.code,{children:".zshrc"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"LD_PRELOAD"})}),(0,r.jsx)(s.td,{children:"Shared object injection"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"SSH Keys"})}),(0,r.jsxs)(s.td,{children:["Append to ",(0,r.jsx)(s.code,{children:"~/.ssh/authorized_keys"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Plist Hijacking"})}),(0,r.jsxs)(s.td,{children:["On macOS: ",(0,r.jsx)(s.code,{children:"~/Library/LaunchAgents/"})]})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-strategic-considerations",children:"\ud83e\udde0 Strategic Considerations"}),"\n",(0,r.jsx)(s.p,{children:"When designing persistence methods, red teamers must consider:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"OPSEC tradeoffs"}),": Is this method noisy? Does it write to disk or trigger EDR rules?"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Privileges required"}),": Userland vs admin vs SYSTEM."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Durability"}),": Will this survive reboots, logouts, AV cleanups?"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Trigger"}),": What initiates the payload? Login, boot, event?"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Example:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"HKCU\\...\\Run"})," is stealthier but only works on login."]}),"\n",(0,r.jsx)(s.li,{children:"A scheduled task with SYSTEM permissions may run independent of user activity."}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-opsec-concerns",children:"\ud83d\udd12 OPSEC Concerns"}),"\n",(0,r.jsx)(s.p,{children:"Persistence can trigger alerts more than almost any other tactic."}),"\n",(0,r.jsx)(s.p,{children:"Tips:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Use ",(0,r.jsx)(s.strong,{children:"native tooling"})," (",(0,r.jsx)(s.code,{children:"schtasks"}),", ",(0,r.jsx)(s.code,{children:"reg"}),", ",(0,r.jsx)(s.code,{children:"wscript"}),") where possible."]}),"\n",(0,r.jsxs)(s.li,{children:["Minimize writes to common ",(0,r.jsx)(s.strong,{children:"AV/EDR-watched locations"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Store payloads in ",(0,r.jsx)(s.strong,{children:"alternate data streams"}),", ",(0,r.jsx)(s.strong,{children:"encrypted files"}),", or ",(0,r.jsx)(s.strong,{children:"non-standard extensions"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Consider ",(0,r.jsx)(s.strong,{children:"\u201cvolatile\u201d persistence"})," (in-memory or re-implant methods) for stealthy ops."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-where-does-persistence-fit",children:"\ud83e\udded Where Does Persistence Fit?"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Initial Access \u2192 Execution \u2192 [ Post-Ex Recon ] \u2192 [ Persistence ] \u2192 Lateral Movement / Objectives\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Persistence is often set ",(0,r.jsx)(s.strong,{children:"before"})," or ",(0,r.jsx)(s.strong,{children:"after"})," lateral movement, depending on the operator\u2019s level of access and environment stability."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-summary",children:"\ud83d\udccc Summary"}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["Persistence is about ",(0,r.jsx)(s.strong,{children:"longevity"})," and ",(0,r.jsx)(s.strong,{children:"strategic foothold"}),". It\u2019s not just about staying in\u2014it\u2019s about coming back, whenever you want, and from wherever you need."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Mastering it gives red teams and adversaries a ",(0,r.jsx)(s.strong,{children:"temporal advantage"}),"\u2014the ability to pause, regroup, and strike again on their own terms."]}),"\n",(0,r.jsx)(s.hr,{})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>d});var i=n(6540);const r={},t=i.createContext(r);function c(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);