"use strict";(self.webpackChunkcybersec_writeups=self.webpackChunkcybersec_writeups||[]).push([[6444],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},9134:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"how-to/OpSec/c2","title":"How to Set Up OPSEC-Safe C2 Infrastructure","description":"---","source":"@site/docs/how-to/OpSec/c2.md","sourceDirName":"how-to/OpSec","slug":"/how-to/OpSec/c2","permalink":"/docs/how-to/OpSec/c2","draft":false,"unlisted":false,"editUrl":"https://github.com/ObsidianStrike/cybersec-writeups/tree/main/docs/how-to/OpSec/c2.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"c2","title":"How to Set Up OPSEC-Safe C2 Infrastructure","sidebar_label":"C2","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Internal Planning Docs","permalink":"/docs/how-to/Pre-Engagement/internal-planning-docs"},"next":{"title":"Payload Obfuscation","permalink":"/docs/how-to/OpSec/payload-obfuscation"}}');var s=r(4848),t=r(8453);const o={id:"c2",title:"How to Set Up OPSEC-Safe C2 Infrastructure",sidebar_label:"C2",sidebar_position:1},c=void 0,l={},d=[{value:"Objective",id:"objective",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Step-by-Step Instructions",id:"step-by-step-instructions",level:3},{value:"\ud83e\uddf1 1. Architect a Multi-Tier C2 Infrastructure",id:"-1-architect-a-multi-tier-c2-infrastructure",level:4},{value:"\ud83d\udd75\ufe0f 2. Provision Infrastructure with OPSEC in Mind",id:"\ufe0f-2-provision-infrastructure-with-opsec-in-mind",level:4},{value:"\ud83c\udf10 3. Set Up Redirectors Using NGINX or Apache",id:"-3-set-up-redirectors-using-nginx-or-apache",level:4},{value:"\ud83e\udeaa 4. Register Domains and Set Up TLS",id:"-4-register-domains-and-set-up-tls",level:4},{value:"\ud83d\udd01 5. Configure C2 Profile for Stealth",id:"-5-configure-c2-profile-for-stealth",level:4},{value:"\ud83e\uddea 6. Test Before Launching",id:"-6-test-before-launching",level:4},{value:"\ud83d\udd25 7. Maintain OPSEC Throughout the Engagement",id:"-7-maintain-opsec-throughout-the-engagement",level:4},{value:"Summary",id:"summary",level:3}];function a(e){const n={code:"code",em:"em",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"objective",children:"Objective"}),"\n",(0,s.jsxs)(n.p,{children:["Design and deploy ",(0,s.jsx)(n.strong,{children:"Command and Control (C2) infrastructure"})," that protects operator identity, masks traffic, and mimics real-world adversary TTPs. OPSEC-safe C2 setups reduce the risk of detection, blacklisting, and attribution during Red Team engagements."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A defined scope and Rules of Engagement (RoE)"}),"\n",(0,s.jsx)(n.li,{children:"Threat model or TTPs selected"}),"\n",(0,s.jsx)(n.li,{children:"Infrastructure provisioning resources (cloud, VPS providers)"}),"\n",(0,s.jsx)(n.li,{children:"Familiarity with one or more C2 frameworks (e.g., Cobalt Strike, Mythic, Sliver)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"step-by-step-instructions",children:"Step-by-Step Instructions"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"-1-architect-a-multi-tier-c2-infrastructure",children:"\ud83e\uddf1 1. Architect a Multi-Tier C2 Infrastructure"}),"\n",(0,s.jsxs)(n.p,{children:["Use a ",(0,s.jsx)(n.strong,{children:"staged C2 architecture"})," with at least:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Beacon/implant \u2192 Redirector"})," (traffic routing only)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redirector \u2192 Backend C2 server"})," (handles logic, staging, post-ex)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This isolates detection and blocks direct connection to the operator\u2019s C2 server."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Layout:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[Target] \u2192 [Redirector: nginx/CDN] \u2192 [Backend C2 Server: CS, Mythic]\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"\ufe0f-2-provision-infrastructure-with-opsec-in-mind",children:"\ud83d\udd75\ufe0f 2. Provision Infrastructure with OPSEC in Mind"}),"\n",(0,s.jsx)(n.p,{children:"Use providers that allow alias registration or crypto payments."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Providers: ",(0,s.jsx)(n.code,{children:"Vultr"}),", ",(0,s.jsx)(n.code,{children:"DigitalOcean"}),", ",(0,s.jsx)(n.code,{children:"OVH"}),", ",(0,s.jsx)(n.code,{children:"BuyVM"}),", ",(0,s.jsx)(n.code,{children:"Shinjiru"}),", etc."]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.strong,{children:"burner email addresses"})," and avoid personal billing info"]}),"\n",(0,s.jsx)(n.li,{children:"Register infrastructure under pseudonyms or temporary accounts"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udccc ",(0,s.jsx)(n.em,{children:"Tip:"})," Consider chaining through ",(0,s.jsx)(n.strong,{children:"VPN + TOR + clean VM"})," when provisioning."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"-3-set-up-redirectors-using-nginx-or-apache",children:"\ud83c\udf10 3. Set Up Redirectors Using NGINX or Apache"}),"\n",(0,s.jsxs)(n.p,{children:["Redirectors forward only ",(0,s.jsx)(n.strong,{children:"specific implant traffic"})," to the backend."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"NGINX Example Config:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:"location /update {\n    proxy_pass https://backendc2[.]com;\n    proxy_set_header Host backendc2.com;\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Tools: ",(0,s.jsx)(n.code,{children:"Apache"}),", ",(0,s.jsx)(n.code,{children:"NGINX"}),", ",(0,s.jsx)(n.code,{children:"socat"}),", ",(0,s.jsx)(n.code,{children:"HAProxy"}),", or Cobalt Strike\u2019s ",(0,s.jsx)(n.code,{children:"redirector.rb"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.strong,{children:"TLS with valid certs"})," (Let\u2019s Encrypt or custom) and domain fronting if desired."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"-4-register-domains-and-set-up-tls",children:"\ud83e\udeaa 4. Register Domains and Set Up TLS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.strong,{children:"reputable-looking domains"})," (",(0,s.jsx)(n.code,{children:"cdn-update.net"}),", ",(0,s.jsx)(n.code,{children:"support-gateway.com"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Register via Namecheap, Gandi, Njalla, or Epik"}),"\n",(0,s.jsxs)(n.li,{children:["Setup ",(0,s.jsx)(n.strong,{children:"Let\u2019s Encrypt certs"})," or mimic common providers (e.g., GoDaddy, Cloudflare)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Optional:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.strong,{children:"Cloudflare"})," as a protective CDN or to simulate domain fronting"]}),"\n",(0,s.jsx)(n.li,{children:"Avoid newly registered domains unless simulating commodity threats"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"-5-configure-c2-profile-for-stealth",children:"\ud83d\udd01 5. Configure C2 Profile for Stealth"}),"\n",(0,s.jsx)(n.p,{children:"In your C2 (e.g., Cobalt Strike, Mythic):"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.strong,{children:"User-Agent"})," to legit traffic (",(0,s.jsx)(n.code,{children:"Mozilla/5.0"}),", ",(0,s.jsx)(n.code,{children:"Outlook/16.0"}),", etc.)"]}),"\n",(0,s.jsx)(n.li,{children:"Mimic headers used by real SaaS tools (e.g., Slack, O365, Zoom)"}),"\n",(0,s.jsxs)(n.li,{children:["Use long ",(0,s.jsx)(n.strong,{children:"sleep intervals"})," and jitter (e.g., ",(0,s.jsx)(n.code,{children:"900s \xb150%"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Sample CS Profile Snippet:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:'set useragent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)";\nhttp-get {\n    set uri "/update";\n    client {\n        header "Accept" "*/*";\n        header "Host" "cdn-update.com";\n    }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"-6-test-before-launching",children:"\ud83e\uddea 6. Test Before Launching"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"whois"}),", ",(0,s.jsx)(n.code,{children:"dig"}),", and ",(0,s.jsx)(n.code,{children:"curl"})," to confirm resolution and proxy behavior"]}),"\n",(0,s.jsx)(n.li,{children:"Verify endpoint detection does not flag implant callbacks"}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"Wireshark"})," to analyze packet structure and TLS negotiation"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"-7-maintain-opsec-throughout-the-engagement",children:"\ud83d\udd25 7. Maintain OPSEC Throughout the Engagement"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Rotate domains and infrastructure on detection or compromise"}),"\n",(0,s.jsx)(n.li,{children:"Avoid hosting multiple client ops from the same backend"}),"\n",(0,s.jsx)(n.li,{children:"Re-image or destroy VPS and domains after the op ends"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Keep logs ",(0,s.jsx)(n.em,{children:"offline"}),", and separate operator actions by engagement."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:["A hardened, well-segmented C2 infrastructure is your lifeline during a Red Team op. Treat its setup with the same rigor as payload development \u2014 because if your C2 burns, ",(0,s.jsx)(n.strong,{children:"so does your access, stealth, and credibility"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Build it right, obfuscate it well, and rotate it like a pro."}),"\n",(0,s.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);